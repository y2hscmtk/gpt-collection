import{r as s,b as c,a as l,l as k}from"./chunks/bookmarks-CZ6oMCFJ.js";const m="gpt-bookmarks",n=new Map;async function i(){if(chrome.sidePanel?.setPanelBehavior)try{await chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!1})}catch(e){console.warn("[gpt-bookmarks] Failed to set side panel behaviour:",e)}}chrome.runtime.onInstalled.addListener(()=>{i()});i();chrome.sidePanel?.onClosed&&chrome.sidePanel.onClosed.addListener(({windowId:e})=>{n.set(e,!1)});chrome.tabs?.onRemoved&&chrome.tabs.onRemoved.addListener((e,o)=>{typeof o?.windowId=="number"&&n.delete(o.windowId)});chrome.action?.onClicked.addListener(async e=>{if(!e?.windowId)return;const o=e.windowId,r=n.get(o)??!1;try{r&&chrome.sidePanel?.close?(await chrome.sidePanel.close({windowId:o}),n.set(o,!1)):(await chrome.sidePanel.open({windowId:o}),n.set(o,!0))}catch(a){console.warn("[gpt-bookmarks] Side panel toggle failed:",a)}});function t(e,o){e({ok:!0,data:o})}function w(e,o){e({ok:!1,error:o?.message??String(o)})}chrome.runtime.onMessage.addListener((e,o,r)=>{if(!(!e||e.scope!==m))return(async()=>{switch(e.type){case"list":{const a=await k();t(r,a);break}case"add":{const a=e.payload||{};a.url||(a.url=c({origin:a.origin,projectId:a.projectId,conversationId:a.conversationId}));const d=await l(a);t(r,d);break}case"remove":{await s(e.payload?.id),t(r,null);break}default:r({ok:!1,error:`Unknown message type: ${e.type}`})}})().catch(a=>{w(r,a)}),!0});
